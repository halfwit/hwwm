#!/bin/sh
# Requires https://github.com/wmutils

# directory of files that correlate to window names
WIN="$XDG_CONFIG_HOME"/x11/window

winsize() {
	while read -r id; do
		# Find our command to run in our file, else set it as default
		cmd="`awk -v r="$(watom $id WM_NAME)" -v s="$(watom $id WM_CLASS)" '$0 ~ r || $0 ~ s {$1=""; print}' "$WIN"`"
		test -z "$cmd" && cmd="`awk '/default/{$1=""; print}' "$WIN"`"
		printf '%s %s\n' "`eval "$cmd"`" "$id"
	done
}

## Main ##
# window dimensions and gap
if watom `lsw -r` FS 2>/dev/null; then
	exit 0
fi

. "$XDG_CONFIG_HOME"/x11/size && [ ! $width ] && [ ! $heigh ] && exit 1
lsw | winsize | binpack -x "$width" -y "$heigh" -g "$gaps"
