#!/bin/sh
# Requires https://github.com/wmutils
#          https://github.com/halfwit/wmgroup
#          https://github.com/halfwit/watom

# directory of files that correlate to window names
WIN="$XDG_CONFIG_HOME"/x11/window

winsize() {
	while read -r id; do
		name="`xprop -id "$id" | awk '/WM_CLASS/{print $NF}' | tr -d '"' `" 
		cmd="`awk -v r="$name" '$0 ~ r {err=1; $1=""; print} END {exit err}' "$WIN" && awk '/default/{$1=""; print}' "$WIN"`"
		printf '%s %s\n' "`eval "$cmd"`" "$id"
	done
}

## Main ##
# window dimensions and gap
if watom `lsw -r` FS 2>/dev/null; then
	exit 0
fi

. "$XDG_CONFIG_HOME"/x11/size && [ ! $width ] && [ ! $heigh ] && exit 1
lsw | winsize | binpack -x "$width" -y "$heigh" -g "$gaps"
